WARNING:root:You tried to specify center_unembed=True for a model using logit softcap, but this can't be done! Softcapping is not invariant upon adding a constantSetting center_unembed=False instead.
Namespace(batch_size=1, select_type='act_toxic_freq', output_file='/data2/xzwnlp/SaeEdit/ManipulateSAE/data/safety/toxic_DINM_train/num128/sae_caa_vector/gemma-2-9b/act_toxic_freq/feature_act_toxic_freq_gemma-2-9b_layer24_16k_resid_post.json', data_file='/data2/xzwnlp/SaeEdit/ManipulateSAE/data/safety/toxic_DINM_train/num128/train.csv', data_name='num128', model_name_or_path='/data2/xzwnlp/model/gemma-2-9b', sae_path='/data2/xzwnlp/gemma-scope-9b-pt-res/layer_24/width_16k/average_l0_114', mode='safety', model_name='gemma-2-9b', system_prompt='', input_format_way='custom', steering_vector_name='gemma-2-9b_sae_layer24_resid_post_16k_steering_vector.pt', AB=False)
Loading checkpoint shards:   0%|          | 0/8 [00:00<?, ?it/s]Loading checkpoint shards:  12%|█▎        | 1/8 [00:01<00:07,  1.10s/it]Loading checkpoint shards:  25%|██▌       | 2/8 [00:02<00:06,  1.11s/it]Loading checkpoint shards:  38%|███▊      | 3/8 [00:03<00:05,  1.19s/it]Loading checkpoint shards:  50%|█████     | 4/8 [00:04<00:04,  1.22s/it]Loading checkpoint shards:  62%|██████▎   | 5/8 [00:05<00:03,  1.22s/it]Loading checkpoint shards:  75%|███████▌  | 6/8 [00:07<00:02,  1.20s/it]Loading checkpoint shards:  88%|████████▊ | 7/8 [00:08<00:01,  1.16s/it]Loading checkpoint shards: 100%|██████████| 8/8 [00:08<00:00,  1.03s/it]Loading checkpoint shards: 100%|██████████| 8/8 [00:08<00:00,  1.12s/it]
WARNING:root:With reduced precision, it is advised to use `from_pretrained_no_processing` instead of `from_pretrained`.
WARNING:root:You are not using LayerNorm, so the writing weights can't be centered! Skipping
Loaded pretrained model /data2/xzwnlp/model/gemma-2-9b into HookedTransformer
#########mode:safety#############
Generating train split: 0 examples [00:00, ? examples/s]Generating train split: 128 examples [00:00, 10795.50 examples/s]
Map:   0%|          | 0/128 [00:00<?, ? examples/s]Map: 100%|██████████| 128/128 [00:00<00:00, 19721.23 examples/s]
Computing the activation selection for activation_selection_contrastive_for_toxic_freq
act for safety:   0%|          | 0/128 [00:00<?, ?it/s]act for safety:   1%|          | 1/128 [00:00<01:47,  1.18it/s]act for safety:   2%|▏         | 2/128 [00:01<01:26,  1.46it/s]act for safety:   2%|▏         | 3/128 [00:01<01:05,  1.91it/s]act for safety:   3%|▎         | 4/128 [00:02<00:54,  2.28it/s]act for safety:   4%|▍         | 5/128 [00:02<00:51,  2.40it/s]act for safety:   5%|▍         | 6/128 [00:02<00:47,  2.55it/s]act for safety:   5%|▌         | 7/128 [00:03<00:44,  2.71it/s]act for safety:   6%|▋         | 8/128 [00:03<00:43,  2.75it/s]act for safety:   7%|▋         | 9/128 [00:03<00:41,  2.85it/s]act for safety:   8%|▊         | 10/128 [00:04<00:50,  2.33it/s]act for safety:   9%|▊         | 11/128 [00:04<00:48,  2.39it/s]act for safety:   9%|▉         | 12/128 [00:05<00:48,  2.40it/s]act for safety:  10%|█         | 13/128 [00:05<00:45,  2.51it/s]act for safety:  11%|█         | 14/128 [00:05<00:44,  2.58it/s]act for safety:  12%|█▏        | 15/128 [00:06<00:42,  2.65it/s]act for safety:  12%|█▎        | 16/128 [00:06<00:40,  2.80it/s]act for safety:  13%|█▎        | 17/128 [00:06<00:38,  2.86it/s]act for safety:  14%|█▍        | 18/128 [00:07<00:40,  2.69it/s]act for safety:  15%|█▍        | 19/128 [00:07<00:38,  2.81it/s]act for safety:  16%|█▌        | 20/128 [00:08<00:39,  2.73it/s]act for safety:  16%|█▋        | 21/128 [00:08<00:37,  2.88it/s]act for safety:  17%|█▋        | 22/128 [00:08<00:35,  2.99it/s]act for safety:  18%|█▊        | 23/128 [00:08<00:35,  2.98it/s]act for safety:  19%|█▉        | 24/128 [00:09<00:34,  3.00it/s]act for safety:  20%|█▉        | 25/128 [00:09<00:34,  3.02it/s]act for safety:  20%|██        | 26/128 [00:09<00:32,  3.13it/s]act for safety:  21%|██        | 27/128 [00:10<00:34,  2.94it/s]act for safety:  22%|██▏       | 28/128 [00:10<00:33,  2.95it/s]act for safety:  23%|██▎       | 29/128 [00:11<00:34,  2.85it/s]act for safety:  23%|██▎       | 30/128 [00:11<00:34,  2.83it/s]act for safety:  24%|██▍       | 31/128 [00:11<00:33,  2.93it/s]act for safety:  25%|██▌       | 32/128 [00:12<00:31,  3.02it/s]act for safety:  26%|██▌       | 33/128 [00:12<00:33,  2.81it/s]act for safety:  27%|██▋       | 34/128 [00:12<00:31,  2.94it/s]act for safety:  27%|██▋       | 35/128 [00:13<00:30,  3.01it/s]act for safety:  28%|██▊       | 36/128 [00:13<00:30,  3.06it/s]act for safety:  29%|██▉       | 37/128 [00:13<00:29,  3.07it/s]act for safety:  30%|██▉       | 38/128 [00:14<00:29,  3.01it/s]act for safety:  30%|███       | 39/128 [00:14<00:29,  2.98it/s]act for safety:  31%|███▏      | 40/128 [00:14<00:29,  3.00it/s]act for safety:  32%|███▏      | 41/128 [00:15<00:28,  3.07it/s]act for safety:  33%|███▎      | 42/128 [00:15<00:27,  3.07it/s]act for safety:  34%|███▎      | 43/128 [00:15<00:28,  2.99it/s]act for safety:  34%|███▍      | 44/128 [00:16<00:29,  2.85it/s]act for safety:  35%|███▌      | 45/128 [00:16<00:28,  2.92it/s]act for safety:  36%|███▌      | 46/128 [00:16<00:27,  2.93it/s]act for safety:  37%|███▋      | 47/128 [00:17<00:27,  2.91it/s]act for safety:  38%|███▊      | 48/128 [00:17<00:28,  2.78it/s]act for safety:  38%|███▊      | 49/128 [00:17<00:27,  2.89it/s]act for safety:  39%|███▉      | 50/128 [00:18<00:26,  2.94it/s]act for safety:  40%|███▉      | 51/128 [00:18<00:25,  3.01it/s]act for safety:  41%|████      | 52/128 [00:18<00:25,  2.92it/s]act for safety:  41%|████▏     | 53/128 [00:19<00:25,  2.96it/s]act for safety:  42%|████▏     | 54/128 [00:19<00:24,  3.00it/s]act for safety:  43%|████▎     | 55/128 [00:19<00:25,  2.90it/s]act for safety:  44%|████▍     | 56/128 [00:20<00:24,  2.96it/s]act for safety:  45%|████▍     | 57/128 [00:20<00:23,  3.05it/s]act for safety:  45%|████▌     | 58/128 [00:20<00:23,  2.94it/s]act for safety:  46%|████▌     | 59/128 [00:21<00:22,  3.07it/s]act for safety:  47%|████▋     | 60/128 [00:21<00:24,  2.83it/s]act for safety:  48%|████▊     | 61/128 [00:21<00:24,  2.75it/s]act for safety:  48%|████▊     | 62/128 [00:22<00:24,  2.71it/s]act for safety:  49%|████▉     | 63/128 [00:22<00:23,  2.78it/s]act for safety:  50%|█████     | 64/128 [00:22<00:22,  2.81it/s]act for safety:  51%|█████     | 65/128 [00:23<00:21,  2.93it/s]act for safety:  52%|█████▏    | 66/128 [00:23<00:20,  2.97it/s]act for safety:  52%|█████▏    | 67/128 [00:23<00:20,  2.95it/s]act for safety:  53%|█████▎    | 68/128 [00:24<00:21,  2.78it/s]act for safety:  54%|█████▍    | 69/128 [00:24<00:21,  2.79it/s]act for safety:  55%|█████▍    | 70/128 [00:25<00:20,  2.89it/s]act for safety:  55%|█████▌    | 71/128 [00:25<00:20,  2.79it/s]act for safety:  56%|█████▋    | 72/128 [00:25<00:19,  2.83it/s]act for safety:  57%|█████▋    | 73/128 [00:26<00:18,  2.90it/s]act for safety:  58%|█████▊    | 74/128 [00:26<00:17,  3.01it/s]act for safety:  59%|█████▊    | 75/128 [00:26<00:16,  3.12it/s]act for safety:  59%|█████▉    | 76/128 [00:27<00:17,  2.91it/s]act for safety:  60%|██████    | 77/128 [00:27<00:17,  2.96it/s]act for safety:  61%|██████    | 78/128 [00:27<00:18,  2.77it/s]act for safety:  62%|██████▏   | 79/128 [00:28<00:21,  2.33it/s]act for safety:  62%|██████▎   | 80/128 [00:28<00:19,  2.48it/s]act for safety:  63%|██████▎   | 81/128 [00:29<00:19,  2.47it/s]act for safety:  64%|██████▍   | 82/128 [00:29<00:19,  2.38it/s]act for safety:  65%|██████▍   | 83/128 [00:29<00:18,  2.48it/s]act for safety:  66%|██████▌   | 84/128 [00:30<00:17,  2.52it/s]act for safety:  66%|██████▋   | 85/128 [00:30<00:16,  2.61it/s]act for safety:  67%|██████▋   | 86/128 [00:31<00:16,  2.48it/s]act for safety:  68%|██████▊   | 87/128 [00:31<00:16,  2.47it/s]act for safety:  69%|██████▉   | 88/128 [00:31<00:15,  2.50it/s]act for safety:  70%|██████▉   | 89/128 [00:32<00:15,  2.58it/s]act for safety:  70%|███████   | 90/128 [00:32<00:14,  2.61it/s]act for safety:  71%|███████   | 91/128 [00:33<00:14,  2.64it/s]act for safety:  72%|███████▏  | 92/128 [00:33<00:13,  2.67it/s]act for safety:  73%|███████▎  | 93/128 [00:33<00:13,  2.67it/s]act for safety:  73%|███████▎  | 94/128 [00:34<00:12,  2.68it/s]act for safety:  74%|███████▍  | 95/128 [00:34<00:12,  2.70it/s]act for safety:  75%|███████▌  | 96/128 [00:34<00:11,  2.75it/s]act for safety:  76%|███████▌  | 97/128 [00:35<00:11,  2.68it/s]act for safety:  77%|███████▋  | 98/128 [00:35<00:11,  2.70it/s]act for safety:  77%|███████▋  | 99/128 [00:36<00:10,  2.74it/s]act for safety:  78%|███████▊  | 100/128 [00:36<00:10,  2.74it/s]act for safety:  79%|███████▉  | 101/128 [00:36<00:09,  2.78it/s]act for safety:  80%|███████▉  | 102/128 [00:37<00:09,  2.75it/s]act for safety:  80%|████████  | 103/128 [00:37<00:09,  2.70it/s]act for safety:  81%|████████▏ | 104/128 [00:37<00:09,  2.66it/s]act for safety:  82%|████████▏ | 105/128 [00:38<00:08,  2.62it/s]act for safety:  83%|████████▎ | 106/128 [00:38<00:08,  2.59it/s]act for safety:  84%|████████▎ | 107/128 [00:39<00:08,  2.54it/s]act for safety:  84%|████████▍ | 108/128 [00:39<00:07,  2.52it/s]act for safety:  85%|████████▌ | 109/128 [00:39<00:06,  2.72it/s]act for safety:  86%|████████▌ | 110/128 [00:40<00:06,  2.68it/s]act for safety:  87%|████████▋ | 111/128 [00:40<00:06,  2.65it/s]act for safety:  88%|████████▊ | 112/128 [00:40<00:05,  2.73it/s]act for safety:  88%|████████▊ | 113/128 [00:41<00:05,  2.71it/s]act for safety:  89%|████████▉ | 114/128 [00:41<00:05,  2.66it/s]act for safety:  90%|████████▉ | 115/128 [00:42<00:04,  2.69it/s]act for safety:  91%|█████████ | 116/128 [00:42<00:04,  2.49it/s]act for safety:  91%|█████████▏| 117/128 [00:42<00:04,  2.45it/s]act for safety:  92%|█████████▏| 118/128 [00:43<00:04,  2.36it/s]act for safety:  93%|█████████▎| 119/128 [00:43<00:03,  2.30it/s]act for safety:  94%|█████████▍| 120/128 [00:44<00:03,  2.25it/s]act for safety:  95%|█████████▍| 121/128 [00:44<00:03,  2.29it/s]act for safety:  95%|█████████▌| 122/128 [00:45<00:02,  2.39it/s]act for safety:  96%|█████████▌| 123/128 [00:45<00:02,  2.39it/s]act for safety:  97%|█████████▋| 124/128 [00:45<00:01,  2.54it/s]act for safety:  98%|█████████▊| 125/128 [00:46<00:01,  2.54it/s]act for safety:  98%|█████████▊| 126/128 [00:46<00:00,  2.64it/s]act for safety:  99%|█████████▉| 127/128 [00:46<00:00,  2.63it/s]act for safety: 100%|██████████| 128/128 [00:47<00:00,  2.71it/s]act for safety: 100%|██████████| 128/128 [00:47<00:00,  2.71it/s]
torch.Size([16384])
tensor([ 0., 23.,  0.,  ...,  3., 38., 21.], device='cuda:0')
torch.Size([16384])
tensor([ 0., 48.,  0.,  ..., 10., 27., 25.], device='cuda:0')
torch.Size([16384])
tensor([0.0000, 0.0232, 0.0000,  ..., 0.0033, 0.0571, 0.0190], device='cuda:0')
torch.Size([16384])
tensor([0.0000, 0.0507, 0.0000,  ..., 0.0088, 0.0205, 0.0346], device='cuda:0')
steering_vector.shape: torch.Size([3584])
steering_vector: tensor([ 0.7507,  0.2916, -0.3693,  ...,  0.1761,  0.8427, -0.9677],
       device='cuda:0', grad_fn=<SqueezeBackward4>)
steering_vector.norm: tensor(59.5604, device='cuda:0', grad_fn=<LinalgVectorNormBackward0>)
feature_attr.shape: torch.Size([16384])
pos_feature_freq.shape: torch.Size([16384])
neg_feature_freq.shape: torch.Size([16384])
pos_act_mean.shape: torch.Size([16384])
neg_act_mean.shape: torch.Size([16384])
